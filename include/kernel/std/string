#pragma once

#include <stddef.h>

#include <iterator>

namespace std {

class string final {
   public:
    using iterator = char*;
    using const_iterator = const char*;

    explicit string();

    explicit string(const string& other);
    explicit string(string&& other);

    explicit string(size_t size, char character);
    explicit string(const string& other, size_t position);
    explicit string(const string& other, size_t position, size_t count);
    string(const char* character_array);
    explicit string(const char* character_array, size_t count);
    template <InputIterator<char> CharInputIterator>
    explicit string(CharInputIterator first, CharInputIterator last);

    ~string();

    string& operator=(const string& other);
    string& operator=(string&& other);

    char& operator[](size_t offset);
    const char& operator[](size_t offset) const;
    const char& at(size_t offset) const;

    const char* c_str() const;
    char* data();

    iterator begin();
    const_iterator cbegin() const;
    iterator end();
    const_iterator cend() const;

    bool empty() const;
    size_t size() const;
    size_t length() const;
    size_t capacity() const;

    void reserve(size_t size);
    void shrink_to_fit();

    string& operator+=(const string& str);
    string& operator+=(char ch);
    string& operator+=(const char* str);
    string& append(const char* str, size_t size);

   private:
    void resize(size_t size);

    char* data_;
    size_t size_;
    size_t capacity_;

    static char placeholder_;
};

template <InputIterator<char> CharInputIterator>
string::string(CharInputIterator first, CharInputIterator last) {
    size_t length = 0;
    for (CharInputIterator current = first; current != last; current++) {
        length++;
    }

    const size_t byte_count_including_terminator = length + 1;

    data_ = new char[byte_count_including_terminator];
    size_ = length;
    capacity_ = length;

    size_t i = 0;
    for (CharInputIterator current = first; current != last; current++, i++) {
        data_[i] = *current;
    }
    data_[i] = '\0';
}

}  // namespace std
